name: DevSecOps Pipeline

on:
    push:
        branches: [master]
    pull_request:
        branches: [master]

jobs:
    build_docker:
        name: Build Docker Image
        runs-on: ubuntu-latest

        steps:
            - name: Checkout code
              uses: actions/checkout@v4

            - name: Set up Docker Buildx
              uses: docker/setup-buildx-action@v3

            - name: Build Docker Image
              run: docker build -t pygoat:latest .
    sca-security:
        name: SCA Scan (pip-audit)
        runs-on: ubuntu-latest
        needs: build_docker

        steps:
            - name: Checkout code
              uses: actions/checkout@v4

            - name: Set Up Python
              uses: actions/setup-python@v5
              with:
                python-version: '3.10'

            - name: Install dependencies
              run: |
                python -m pip install --upgrade pip
                pip install -r requirements.txt

            - name: Run pip-audit
              uses: pypa/gh-action-pip-audit@v1.1.0
              continue-on-error: true

      